{% extends "gso_office/gso_base_dashboard.html" %}
{% block title %}Analytics{% endblock %}



{% block page_header %}
<h1 class="page-title mb-0">System Analytics</h1>
{% endblock %}



{% block main_content %}


<!-- ===== REQUESTS OVERVIEW ===== -->
<h5 class="mb-3">Requests Overview</h5>
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>Total Requests</h6>
      <h3 class="fw-bold text-primary">{{ total_requests }}</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>Completed</h6>
      <h3 class="fw-bold text-success">{{ completed_requests }}</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>Pending</h6>
      <h3 class="fw-bold text-warning">{{ pending_requests }}</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>In Progress</h6>
      <h3 class="fw-bold text-info">{{ in_progress_requests }}</h3>
    </div>
  </div>
</div>

<div class="mt-3">
  <canvas id="requestsChart" height="120"></canvas>
</div>

<!-- ===== INVENTORY OVERVIEW ===== -->
<h5 class="mt-5 mb-3">Inventory Overview</h5>
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>Total Materials</h6>
      <h3 class="fw-bold text-primary">{{ total_materials }}</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>Low Stock (â‰¤10)</h6>
      <h3 class="fw-bold text-warning">{{ low_stock_materials }}</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h6>Out of Stock</h6>
      <h3 class="fw-bold text-danger">{{ out_of_stock }}</h3>
    </div>
  </div>
</div>

<div class="mt-3">
  <canvas id="inventoryChart" height="120"></canvas>
</div>

<!-- ===== SCRIPTS ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // ===== REQUESTS CHART =====
  const reqCtx = document.getElementById('requestsChart').getContext('2d');
  new Chart(reqCtx, {
    type: 'bar',
    data: {
      labels: ['Completed', 'Pending', 'In Progress'],
      datasets: [{
        label: 'Requests Overview',
        data: [{{ completed_requests }}, {{ pending_requests }}, {{ in_progress_requests }}],
        backgroundColor: ['#198754', '#ffc107', '#0dcaf0']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: 'Request Status Overview' }
      },
      scales: { y: { beginAtZero: true } }
    }
  });

  // ===== INVENTORY CHART =====
  const invCtx = document.getElementById('inventoryChart').getContext('2d');
  new Chart(invCtx, {
    type: 'pie',
    data: {
      labels: ['Available', 'Low Stock', 'Out of Stock'],
      datasets: [{
        data: [
          {{ total_materials|add:"-"|add:low_stock_materials|add:"-"|add:out_of_stock }},
          {{ low_stock_materials }},
          {{ out_of_stock }}
        ],
        backgroundColor: ['#0d6efd', '#ffc107', '#dc3545']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: { display: true, text: 'Inventory Status Overview' }
      }
    }
  });
</script>
{% endblock %}
